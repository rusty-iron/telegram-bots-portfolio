# FormBot

Асинхронный Telegram-бот для автоматизации сбора контактных данных клиентов.

![Python](https://img.shields.io/badge/Python-3.10+-blue.svg)
![aiogram](https://img.shields.io/badge/aiogram-3.x-blue.svg)

## 📋 О проекте

FormBot — профессиональное решение для автоматизации сбора заявок через Telegram с полноценной системой управления.

**Ключевые особенности:**
- 🎯 **Удобный UX** — пошаговый опрос с навигацией назад
- 🛡️ **Валидация** — проверка всех введенных данных
- 👨‍💼 **Админ-панель** — полное управление заявками без выхода из Telegram
- 🔄 **Статусы** — отслеживание работы с клиентами
- 💬 **Общение** — ответы клиентам напрямую из бота
- 📊 **Экспорт** — выгрузка данных в CSV
- 🐳 **Docker** — быстрое развертывание на любом сервере

**Целевая аудитория:** Малый и средний бизнес, маркетинговые агентства, стартапы

## Возможности

- Пошаговый сбор данных с индикатором прогресса
- Валидация всех полей (имя, телефон, email)
- Навигация «Назад» на каждом этапе
- Подтверждение данных перед сохранением
- **Админ-панель** с управлением заявками
- **Статусы заявок** (Новая → В работе → Завершена)
- **Ответ клиентам** напрямую из бота
- Экспорт заявок в CSV
- Уведомления администратора о новых заявках
- Защита от флуда (anti-flood middleware)
- Логирование с ротацией файлов
- Docker-контейнеризация

## Демонстрация

<!-- Добавьте скриншоты вашего бота -->

<details>
<summary>Скриншоты</summary>

### Приветствие
![Start](docs/screenshots/start.png)

### Процесс заполнения
![Form](docs/screenshots/form.png)

### Подтверждение
![Confirm](docs/screenshots/confirm.png)

### Уведомление администратора
![Admin](docs/screenshots/admin.png)

</details>

## Структура проекта

```
FormBot/
├── src/
│   ├── handlers/           # Обработчики команд и состояний
│   │   ├── __init__.py
│   │   ├── admin.py        # Админ-панель
│   │   ├── commands.py     # /start, /help, /cancel, /export
│   │   └── form.py         # FSM-логика опроса
│   ├── keyboards/          # Клавиатуры
│   │   ├── __init__.py
│   │   ├── admin.py        # Inline-кнопки админки
│   │   └── reply.py        # Reply-кнопки
│   ├── middlewares/        # Middleware
│   │   ├── __init__.py
│   │   └── throttling.py   # Anti-flood защита
│   ├── states/             # FSM-состояния
│   │   ├── __init__.py
│   │   ├── admin.py        # Состояния админки
│   │   └── form.py         # Состояния формы
│   ├── utils/              # Утилиты
│   │   ├── __init__.py
│   │   ├── validators.py   # Валидация данных
│   │   ├── csv_handler.py  # Базовая работа с CSV
│   │   └── csv_manager.py  # Расширенный менеджер CSV
│   ├── __init__.py
│   └── config.py           # Конфигурация
├── data/                   # Данные (CSV-файлы)
├── logs/                   # Логи
├── main.py                 # Точка входа
├── Dockerfile
├── docker-compose.yml
├── requirements.txt
├── .env.example
├── .gitignore
└── README.md
```

## Требования

- Python 3.10+
- Telegram Bot Token (получить у [@BotFather](https://t.me/BotFather))

## Установка

### Вариант 1: Локальный запуск

1. **Клонируйте репозиторий:**
   ```bash
   git clone https://github.com/rusty-iron/telegram-bots-portfolio.git
   cd telegram-bots-portfolio/projects/form_bot
   ```

2. **Создайте виртуальное окружение:**
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/macOS
   # или
   venv\Scripts\activate     # Windows
   ```

3. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

4. **Настройте переменные окружения:**
   ```bash
   cp .env.example .env
   ```

   Отредактируйте `.env`:
   ```env
   BOT_TOKEN=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
   ADMIN_ID=987654321
   LOG_LEVEL=INFO
   ```

5. **Запустите бота:**
   ```bash
   python main.py
   ```

### Вариант 2: Docker

1. **Настройте переменные окружения:**
   ```bash
   cp .env.example .env
   # Отредактируйте .env
   ```

2. **Запустите с Docker Compose:**
   ```bash
   docker-compose up -d --build
   ```

3. **Просмотр логов:**
   ```bash
   docker-compose logs -f
   ```

4. **Остановка:**
   ```bash
   docker-compose down
   ```

## Команды бота

| Команда | Описание |
|---------|----------|
| `/start` | Начать заполнение заявки |
| `/help` | Справка по использованию |
| `/cancel` | Отменить заполнение формы |
| `/admin` | Открыть админ-панель (только админ) |
| `/export` | Экспорт данных в CSV (только админ) |

## Процесс заполнения заявки

```
Шаг 1: Имя         →  Валидация: 2-50 символов
                   ↓
Шаг 2: Телефон     →  Валидация: +7... или 8...
                   ↓
Шаг 3: Email       →  Валидация: корректный формат
                   ↓
Шаг 4: Сообщение   →  Опционально, до 500 символов
                   ↓
Подтверждение      →  ✅ Всё верно / 🔄 Начать заново
                   ↓
Сохранение + Уведомление админа
```

## Админ-панель

Команда `/admin` открывает интерактивную панель управления заявками.

### Возможности

- **Просмотр заявок** по категориям (все, новые, в работе, завершённые)
- **Статусы заявок**: 🆕 Новая → ⏳ В работе → ✅ Завершена
- **Пагинация** — по 10 заявок на странице
- **Детальный просмотр** каждой заявки
- **Изменение статуса** одним кликом
- **Ответ клиенту** напрямую из бота
- **Удаление заявок** с подтверждением
- **Экспорт в CSV** — выгрузка всех данных

### Интерфейс

```
┌─────────────────────────┐
│   🎛️ Админ-панель       │
├─────────────────────────┤
│ 📋 Все заявки (15)      │
│ 🆕 Новые (8)            │
│ ⏳ В работе (5)         │
│ ✅ Завершённые (2)      │
│ 💾 Экспорт в CSV        │
└─────────────────────────┘
```

### Детальный просмотр заявки

```
┌─────────────────────────────────────────┐
│          🆕 Заявка #123                 │
├─────────────────────────────────────────┤
│ 👤 Имя: Иван Иванов                     │
│ 📱 Телефон: +79991234567               │
│ 📧 Email: ivan@example.com              │
│ 💬 Сообщение: Текст сообщения          │
│ ⏰ Создано: 20.01.2026 14:30           │
├─────────────────────────────────────────┤
│ [⏳ В работу] [✅ Завершить]            │
│ [💬 Ответить клиенту]                   │
│ [🗑️ Удалить заявку]                    │
│ [⬅️ К списку]                           │
└─────────────────────────────────────────┘
```

## Формат CSV

```csv
timestamp,user_id,name,phone,email,message,status,updated_at
2026-01-20 10:30:00,123456789,Иван Иванов,+79991234567,ivan@example.com,Хочу узнать о продукте,Новая,2026-01-20 10:30:00
```

### Поля

| Поле | Описание |
|------|----------|
| `timestamp` | Дата и время создания заявки |
| `user_id` | Telegram ID пользователя |
| `name` | Имя клиента |
| `phone` | Номер телефона |
| `email` | Email адрес |
| `message` | Текст сообщения |
| `status` | Статус заявки (Новая / В работе / Завершена) |
| `updated_at` | Дата и время последнего обновления |

## Конфигурация

| Переменная | Описание | По умолчанию |
|------------|----------|--------------|
| `BOT_TOKEN` | Токен бота от @BotFather | — |
| `ADMIN_ID` | Telegram ID администратора | — |
| `LOG_LEVEL` | Уровень логирования | `INFO` |

## Разработка

### Проверка типов
```bash
pip install mypy
mypy src/
```

### Форматирование
```bash
pip install black isort
black .
isort .
```

## Технологии

- **[aiogram 3.x](https://docs.aiogram.dev/)** — асинхронный фреймворк для Telegram Bot API
- **[Pydantic Settings](https://docs.pydantic.dev/latest/concepts/pydantic_settings/)** — управление конфигурацией
- **[Docker](https://www.docker.com/)** — контейнеризация

## Лицензия

Все права защищены. Использование кода возможно только после приобретения лицензии.

Для получения коммерческой лицензии свяжитесь:
- **Email:** rustam_zaripov@mail.com
- **Telegram:** @pasli_demir

---

## 📞 Контакты

**Рустам Зарипов** — 15+ летний опыт в IT

- **Email:** rustam_zaripov@mail.com
- **Telegram:** @pasli_demir
- **LinkedIn:** [linkedin.com/in/rustamzaripov](https://www.linkedin.com/in/rustamzaripov)
- **GitHub:** [github.com/rusty-iron](https://github.com/rusty-iron)

---


